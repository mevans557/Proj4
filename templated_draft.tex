%%%%%%%%%%%%%%%%%%%%%
% Version 1 17/10/25


\documentclass[12pt,a4paper,openany,twoside]{book}
\usepackage[top=1in, bottom=1in, left=0.8in, right=0.8in]{geometry} % 0.8 inch margins

% Language and date format
\usepackage[UKenglish]{babel} 
\usepackage[UKenglish]{isodate}
\cleanlookdateon 

% Fonts
\usepackage[T1]{fontenc} %DO NOT CHANGE
\usepackage{lmodern} % better Latin Modern fonts %DO NOT CHANGE
\usepackage{microtype} % improves justification and kerning 

% Graphics and captions
\usepackage{graphicx} 
\usepackage[dvipsnames]{xcolor} % Gives you colours! 
\usepackage[margin=15pt,font=footnotesize,labelfont=bf,format=hang]{caption} 
\usepackage{subcaption} 
\usepackage{pgfplots} % you can import graphs as PGF files 
\pgfplotsset{compat=1.18} 
\usepackage{float}

% Maths
\usepackage{amsmath,amssymb,mathtools} 
\usepackage{bm} % Making letters bold 
\usepackage{isomath} % Modern standards 

% Theorems, definitions, etc.
\usepackage{amsthm} 
\newtheorem{theorem}{Theorem}[chapter] % Number theorem per chapter
\newtheorem{lemma}[theorem]{Lemma} % Number lemmas like theorems
\newtheorem{definition}{Definition}[chapter] % Number definitions per chapter

% Lists, tables, units
\usepackage{enumitem} % Allows for formatting of lists 
\setlist{topsep=0pt} 
\usepackage{booktabs} % Prettier tables 
\usepackage{siunitx} % Typeset measurements correctly 

% Referencing
\usepackage{natbib}

\bibliographystyle{abbrvnat} % possible citation style
%\bibliographystyle{plain} % possible citation style
%\setcitestyle{authoryear,open={(},close={)}} % Many options available. Can be changed after discussing with your supervisor.
\usepackage[pdfencoding=auto,pdftitle={Dissertation},pdflang={en-GB}]{hyperref} % Make links work
\hypersetup{
	colorlinks = true,
	linkcolor = black,
	citecolor = black
}
\usepackage{cleveref} % Easy internal referencing 

% Formatting
\usepackage[raggedright]{titlesec} %DO NOT CHANGE
\usepackage{fancyhdr} %DO NOT CHANGE

%% Subfiles so you can write separate chapter files [You can enable this if you're using subfiles]
%\usepackage{subfiles}
%\newcommand{\subfilebibliography}{%
%	\ifSubfilesClassLoaded{%
%		\bibliography{references.bib}
%	}{}
%} % Makes the bibliography work for every chapter file

% Headers and footers. 
\pagestyle{fancy} %DO NOT CHANGE
\renewcommand{\headrulewidth}{0pt} %DO NOT CHANGE
\renewcommand\sectionmark[1]{\markright{\thesection\; #1}} %DO NOT CHANGE
\fancyhead[RO]{\small\it\lowercase\nouppercase\selectfont\rightmark} %DO NOT CHANGE
\fancyhead[LO]{}%DO NOT CHANGE
\fancyhead[LE]{\small\it\lowercase\nouppercase\selectfont\rightmark} %DO NOT CHANGE
\fancyhead[RE]{} %DO NOT CHANGE
\setlength{\headheight}{15pt} %DO NOT CHANGE
\fancypagestyle{blank}{\fancyhf{}\fancyfoot[C]{}\renewcommand{\headrulewidth}{0pt}} %DO NOT CHANGE

% Standard spacing
\setlength{\parindent}{0ex} %DO NOT CHANGE
\setlength{\parskip}{1ex} %DO NOT CHANGE
\let\cleardoublepage\clearpage %DO NOT CHANGE


% Chapter title
\titleformat{\chapter}[display] %DO NOT CHANGE
{\Huge\bfseries}   % font size and style %DO NOT CHANGE
{\chaptername\ \thechapter} % label %DO NOT CHANGE
{20pt}             % spacing between label and title %DO NOT CHANGE
{\Huge}            % title formatting %DO NOT CHANGE

\titlespacing*{\chapter} %DO NOT CHANGE
{0pt}    % left margin %DO NOT CHANGE
{0pt}   % space before chapter title %DO NOT CHANGE
{20pt}   % space after chapter title %DO NOT CHANGE

% Section title %DO NOT CHANGE
\titleformat{\section} %DO NOT CHANGE
{\large\bfseries}  % font size and style %DO NOT CHANGE
{\thesection}      % label %DO NOT CHANGE
{1em}              % spacing between label and title %DO NOT CHANGE
{} %DO NOT CHANGE

\titlespacing*{\section} %DO NOT CHANGE
{0pt}    % left margin %DO NOT CHANGE
{10pt}   % space before section title %DO NOT CHANGE
{10pt}   % space after section title %DO NOT CHANGE

% Subsection title %DO NOT CHANGE
\titleformat{\subsection} %DO NOT CHANGE
{\normalsize\bfseries}  % font size and style %DO NOT CHANGE
{\thesubsection}      % label %DO NOT CHANGE
{1em}              % spacing between label and title %DO NOT CHANGE
{}

\titlespacing*{\subsection} %DO NOT CHANGE
{0pt}    % left margin %DO NOT CHANGE
{10pt}   % space before subsection title %DO NOT CHANGE
{0pt}   % space after subsection title %DO NOT CHANGE


%From here you can find useful commands to save time and make things look nice. You can use them, change them, or add to them at will

% Vectors, matrices etc.
\renewcommand{\v}[1]{\mathbf{#1}}      % Generic vector
\newcommand{\uv}[1]{\widehat{\mathbfit{#1}}}      % Generic unit vector
\renewcommand{\t}[1]{\mathsfbfit{#1}}	 % Generic tensor
\newcommand{\m}[1]{\mathsfbf{#1}}	 % Generic matrix
\newcommand{\tu}[1]{\bm{\mathsf{#1}}}	 % Upright tensor (for zero tensor)

%Vector operators
\renewcommand{\d}{{\mathrm d}}
\def \p {\partial}
\newcommand{\vnabla}{\bm{\nabla}}
\newcommand{\Lap}{{\Delta}} %Pure Laplacian
\newcommand{\aLap}{\nabla^2} %Applied Laplacian
%Hats, tildes and bars that fit
\renewcommand{\hat}{\widehat}
\renewcommand{\tilde}{\widetilde}
\renewcommand{\bar}{\overline}

% Differentiating 
\newcommand{\fd}[2]{\mathchoice{\frac{\d #1}{\d #2}}{\d #1/\d #2}{\d #1/\d #2}{\d #1/\d #2}}
\newcommand{\fdd}[2]{\mathchoice{\frac{\d^2 #1}{\d #2^2}}{\d^2 #1/\d #2^2}{\d^2 #1/\d #2^2}{\d^2 #1/\d #2^2}}
\newcommand{\fddd}[2]{\mathchoice{\frac{\d^3 #1}{\d #2^3}}{\d^3 #1/\d #2^3}{\d^3 #1/\d #2^3}{\d^3 #1/\d #2^3}}
\newcommand{\fdddd}[2]{\mathchoice{\frac{\d^4 #1}{\d #2^4}}{\d^4 #1/\d #2^4}{\d^4 #1/\d #2^4}{\d^4 #1/\d #2^4}}
\newcommand{\fdn}[3]{\mathchoice{\frac{\d^{#1} #2}{\d #3^{#1}}}{\d^{#1} #2/\d #3^{#1}}{\d^{#1} #2/\d #3^{#1}}{\d^{#1} #2/\d #3^{#1}}}
\newcommand{\pd}[2]{\mathchoice{\frac{\p #1}{\p #2}}{\p #1/\p #2}{\p #1/\p #2}{\p #1/\p #2}}
\newcommand{\pdd}[2]{\mathchoice{\frac{\p^2 #1}{\p #2^2}}{\p^2 #1/\p #2^2}{\p^2 #1/\p #2^2}{\p^2 #1/\p #2^2}}
\newcommand{\pddmixed}[3]{\mathchoice{\frac{\p^2 #1}{\p #2 \p #3}}{\p^2 #1 /\p #2 \p #3}{\p^2 #1 /\p #2 \p #3}{\p^2 #1 /\p #2 \p #3}}
\newcommand{\pddd}[2]{\frac{\p^3 #1}{\p #2^3}}
\newcommand{\pdn}[3]{\mathchoice{\frac{\p^{#1} #2}{\p #3^{#1}}}{\p^{#1} #2/\p #3^{#1}}{\p^{#1} #2/\p #3^{#1}}{\p^{#1} #2/\p #3^{#1}}}

% Misc
\DeclareMathSymbol{\Delta}{\mathalpha}{operators}{1} % Keeps Delta upright
\DeclareMathSymbol{\Gamma}{\mathalpha}{operators}{0} % Keeps Gamma upright
\newcommand{\ep}{\varepsilon} % A more normal epsilon

% Upright e and i for exponential and imaginary number
\newcommand{\e}{\mathrm{e}}
\renewcommand{\i}{\mathrm{i}}

	
\begin{document} %DO NOT REMOVE the title page. Just edit it.
\frontmatter
	% Pretty title page
	\thispagestyle{empty}
	\begin{titlepage}
		\begin{center}
			\includegraphics[scale=0.8]{images/durham-logo.pdf}
			\vspace{45mm}
			
			\Huge \textbf{All your nodes are belong to us: An exploration of percolation-like disease modelling.}
			
			\vspace{15mm}
			\large
			\begin{align*}
				\textit{by} &\quad \text{Matthew Evans} \\[4mm]
				\textit{Supervisor} &\quad \text{Dr Andrew Krause}
			\end{align*}
			\vspace{35mm}
			
			A dissertation submitted for the degree of \\
			\emph{MMath Mathematics}
			\vspace{5mm}
			
			\today
		\end{center}
	\end{titlepage}
	\normalsize
	
	% ----- PLAGIARISM DECLARATION ----- 
        % DO NOT REMOVE. WRITE YOUR NAME IN THE APPROPRIATE PLACE TO ACKNOWLEDGE THAT YOU HAVE READ, HAVE UNDERSTOOD, AND CONFIRM THAT YOU ADHERE TO THE STATEMENT.
	\begin{center}
		\large\textbf{Plagiarism declaration}
	\end{center}
	\begin{quote}
		This piece of work is a result of my own work and I have complied with the Departmentâ€™s guidance on multiple submission and on the use of AI tools. Material from the work of others not involved in the project has been acknowledged, quotations and paraphrases suitably indicated, and all uses of AI tools have been declared.
	\end{quote}
	\vfill
	I, \underline{Matthew Evans} confirm that I have read, understood, and have adhered to the plagiarism declaration above.
	
	\newpage
	
		% ----- Declaration of use of AI tools in the writing process. ----- DO NOT REMOVE. Fill as needed 
	\begin{center}
		\large\textbf{Declaration of use of AI tools in the writing process}
	\end{center}
	\begin{center}
                No AI tools were used in this project, for any purpose.
	\end{center}
	
	
	\newpage
	
	% ----- ABSTRACT ----- % You may remove if you want or modify upon agreement with your supervisor
	\begin{center}
		\large\textbf{Abstract}
	\end{center}
	\begin{quote}
                TODO: write one of these
	\end{quote}
	
	\newpage
	
	% ----- ACKNOWLEDGEMENTS ----- % You may remove if you want or modify upon agreement with your supervisor

	% ----- LIST OF FIGURES ----- % You may remove if you want or modify upon agreement with your supervisor
	
	\listoffigures
	\markboth{}{} 
	%	The name of the figure that appears in the list is taken from the short description of the caption, i.e.
	% \caption[short caption - appears in the list of figures]{long caption - appears under the figure}
	% if no short description appears, i.e. if you use \caption{something} then 'something' will appear in the list of figures (and might be a very long sentence!).
	
	\newpage
	
	% ----- LIST OF TABLES----- % You may remove if you want or modify upon agreement with your supervisor
	
	\listoftables
	\markboth{}{} 
	% You will need to use the Table environment (not Tabular) and to use \caption in order for the table to appear in the above list (you can wrap the tabular environment within a table environemnt, see an example below). Much like with the list of figures, the short description of the caption is the one that is taken for the list of tables. 
	
	\newpage
	
	% ----- LIST OF NOTATION----- % You may remove if you want or modify upon agreement with your supervisor
	
	\chapter*{Notation}

	
	\begin{tabular}{p{4cm} l  }
	\end{tabular}
	
	
	% Pretty table of contents - DO NOT CHANGE OR REMOVE
	\setlength{\parskip}{0.2ex}
	\setcounter{tocdepth}{1}
	\renewcommand{\baselinestretch}{0.95}\normalsize
	\tableofcontents
	\renewcommand{\baselinestretch}{1}\normalsize
	\markboth{}{} 
	\setlength{\parskip}{1ex}
	

\mainmatter

\chapter{Introduction}

Throughout human history, disease has been one of the greatest societal challenges. From the black death, to COVID-19, widespread infection has disrupted society, caused economic recessions, and caused suffering to millions of people \citep{prabhuHistorysSevenDeadliest}. It is therefore no surprise that Epidemiology has a rich and vaired history, as we have tried to understand diseases from their chemical functions, to their effect on the human body, to how they spread through a population. It is this last problem which this report is concerned with.

Disease modelling has the potential to impact governmental policy with regards to pandemic preparedness and responses, as well as outbreak containment and response \citep{gov.ukEpidemiologicalModellingFrequently}. It is therefore of great importance to develop accurate and realistic models for disease spread, and for these to be flexible enough to be effective in their use \citep{lancetHowModellingCan2024}. It is also important to make these models easy to interpret and communicate about. The effectiveness of this was evident during the COVID-19 pandemic, as a great number of people were encouraged to ``flatten the curve'' - a direct reference to the underlying models used to predict the effect of the pandemic \citep{ecdcVideoCOVID19Flatten2020}.

Now the effects of the COVID-19 pandemic are waning, and so it is important to build upon the huge amount of work that was done at the time, to develop more accurate and useful models for other diseases with different attributes, such as passive immunity from birth. These models can help to shape public policy surrounding not just pandemics and outbreaks, but also vaccination programmes, and other forms of aid globally.

\chapter{Background}

Many approaches to disease modelling utilise a compartmental model, which in the years following the COVID-19 pandemic have become known to a much wider section of the general public than before. Many are therefore familiar with terms such as "R-value", as this was often reported in the media, for example \citet{bbcCoronavirusWhatNumber2020}. The models the public are familiar with are generally of the SIR type, where the population are grouped into three compartments: Susceptible, Infected, and Removed. However, this model is part of a larger family of compartmental models, the simplest being the SI model which does not have the Removed section. There are also more complex versions, such as the MSEIRS model, which models passive immunity, latency periods, and temporary immunity, which have existed for quite some time \citep{menonModellingSimulationCOVID192020}.

These models generally make an assumption of spatial homogeneity, and so more complex models have been developed to address this shorcoming. These include reaction-diffusion models \citep{davydovychReactionDiffusionEquations2023}, and models with interacing subpopulations \citep{keeling17MetapopulationDynamics2004}. However, these still make an assumption that the disease spread can be modelled in a continuous space; logically though, we know that disease spread is fundamentally a discretised process, as an individual is either infected or not.

There has therefore been some work put into stochastic simulations of these systems, in order to more accurately model the discrete nature of the populations \citep{stollenwerkMasterEquationSolution2000}. However, these also unfortunately lack the capacity to examine the effects of connections between individuals directly, and generally assume a well-mixed population.

To address this deficiency, a large amount of work has been done modelling diseases on various networks. Some of these are reminiscent of percolation theory results, such as giant component formation on random graphs \citep{browneInfectionPercolationDynamic2021}. Another recent approach modelled random walkers on random graphs, to mimic human movement patterns and model vector-born diseases \citep{grangerStochasticCompartmentModel2024}. In \citet{croccoloSpreadingInfectionsRandom2020}, the authors applied percolation-theoretic methods and results to a model of the COVID-19 pandemic in the USA, and explored the effects of lockdowns on disease spread.

I seek here to expand on this previous work, by creating a model of disease spread on a random network, and observing how changes both to the network structure and to the disease parameters qualitatively affect the epidemic. These results are compared to stochastic simulations based on a Chemical Master Equation approach to the population modelling, using the Gillespie SSA.

\chapter{The Basic Model}

I began by experimenting with a custom implementation for the model in C++, where each node is represented by a struct, containing a character representing the state of the node, as well as smart pointers to its neighbouring nodes. This had the advantage of being a very fast implementation, not limited to any particular structure, to which dynamic links could easily be added. It also encapsulated the idea of a connected network succinctly. This was also a very low-memory usage implementation, able to model a $1000 \times 1000$ lattice in just over 100MB of memory.

I built this model as I was attempting to get around the issues of using an adjacency matrix for such a large model, as an adjacency matrix for a million vertices requires a quadrillion integers to be stored, which would take approximately 100GB of memory, far more than I had ready access to. However, after discussing further with my supervisor, he suggested I instead look into sparse matrices, a tool developed to deal with this exact problem.

To implement a first approach using smart matrices, I switched to Python, as the faster speed of development relative to C++ was desirable, alongside the easy to use libraries such as networkx and matplotlib, which would allow me to clearly plot the graph and the disease spread across it.

I first focussed on constructing the adjacency matrix to represent the lattice graph, using the scipy llibrary. I did some research to see if there was an existing function to create the adjacency matrix of a lattice graph. Unfortunately there was not, but I was able to find a stackoverflow thread regarding this \citep{guillefixAnswerHowCan2017}. However, it was not clear exactly what was meant in this discussion. I will lay out here how the implementation I eventually settled on works.

\section{Generating the Adjacency Matrix}

We consider the lattice as arranged by rows. Then the adjacency matrix can be considered as a matrix of matrices, where those on the diagonal encode how the vertices within a row are connected, and those on the adjacent diagonals encode the connection of each vertex in a row with each vertex in the adjacent row. Thus, as each vertex in a row is connected to only one of the vertices in the next row, that being the vertex in the same column, these offset-diagonal matrices are all the identity matrix. Essentially this encodes that the vertex in row $i$ and column $j$ is connected to the vertices in rows $i+1$ and $i-1$, and column $j$. It thus only remains to construct the matrices describing the in-row connections of the vertices, and due to the rows all being identical, a copy of this sub-matrix will be placed in every place along the diagonal of the overall adjacency matrix.

Within a row, each vertex is connected only to its neighbours. That is, a vertex in row $i$ and column $j$ is connected only to the vertices in row $i$ and columns $j-1$, $j+1$. This is a matrix with $1$s on the diagonals adjacent to the leading diagonal, and $0$s everywhere else. Clearly this pattern is also the macro structure of the adjacency matrix describing where the identity matrices sit. Hence, for a square lattice, we can simply generate this matrix, and then use the Kronecker product to first place an identity matrix in all of the positions adjacent to the diagonal, and then take the Kronecker product the other way around, to place the adjacent-diagonals matrix along the diagonal of the overall adjacency matrix.

It is worth noting also, that the matrix containing $1$s only on the adjacent diagonals, and $0$s everywhere else, is clearly a Toeplitz matrix. The code therefore generates the first row of this matrix, before using \verb|scipy.linalg.toeplitz|. The identity matrix is generated using \verb|scipy.sparse.eye_array|, utilising the \verb|sparse| part of the library to ensure memory efficiency. The matrices are then combined using \verb|scipy.sparse.kron| to perform the Kronecker product.

This generates the matrix representing a 2D lattice, with all edges existing. In order to carry out bond percolation \citep{weissteinBondPercolation}, we must remove some of these edges, with probability $p$ of an edge existing. In order to ensure accuracy here, the various $(i, j)$ pairs corresponding to the non-zero entries in the uppper triangle of the adjacency matrix are found, using \verb|scipy.sparse.find| and \verb|scipy.sparse.triu|. These are then filtered according to the probability $p$, and the entries of the adjacency matrix corresponding to the edges to be removed are set to $0$. These are then removed entirely (to save memory) using \verb|scipy.sparse.csr_matrix.eliminate_zeros|. This results in an adjacency matrix describing a lattice where each edge exists with probability $p$. This algorithm is used in all of the models to efficiently generate such matrices.

\chapter{The Chemical Master Equation Model}

\chapter{Creating the Model}

\chapter{Implementing the Model}

\chapter{Analysis of Criticality}

\chapter{Comparison between the networked and CME model}

\bibliography{mybib.bib}

\end{document}